% 2783 words

%\subsection{Key Questions}
%what was the scope and how was it defined \\
%what filters were used \\
%what were the walking and cycling speeds used \\
%what were the travel times calculated \\
%what was the directness of travel on different networks \\
%what is the distribution of travel times in the different networks \\
%what lsoas changed the most and least across networks \\
%how did removing road types affect the number of lsoa centers connected? \\
%how long did the calculations take? \\
%Did removing directionality from the networks have a significant effect? \\
%Did removing directionality mediate the effect of removing primary and trunk streets? \\


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Scope}


Scope was defined to capture the largest computationally feasible network with a simple set of rules. 

The first rule was to restrict the network to ``Inner London''. This has the advantage of a formal designation by the GLA for each borough (\cite{innerlondon}). The second rule was to restrict the scope to the area north of the River Thames. This has two advantages. First it further refines the study area to a higher density segment of the city with a higher portion of journeys to work done by bicycle. Second, it removes the need for a trip to cross the river via a bridge. Including bridges in the analysis would have made drawing conclusions more difficult as the ability to cross the river would have been a deciding factor in the possibility of a journey and a key determinant of the journey's distance, requiring a cyclist to go far out of their way to use one of only a dozen bridges potentially available. 

Table \ref{table:commute_data} contains some data about journeys to work in the scope of the study area. The area defined captures 18\% of the population, 16.8\% of the working adults, and 25\% of the jobs in Greater London. 8.2\% of the journey's to work are contained in this area. Additionally, rates of cycling are higher in Inner London than in the periphery as seen in the 5\% rate of cycling between locations within the area compared to the 2.4\% London average. Finally, the area contains 25\% of the traffic incidents where a cyclist was killed or seriously injured between 1989 and 2004 (\cite{cyclistksi}). 
 
\begin{table}[]
\centering
\begin{tabular}{lcccl}
 Mode Share Within Scope & All Modes & Bicycle & \% by bicycle &  \\
 \hline
 Origin in scope &  981,354 & 46,832 & 4.8\% &  \\
 Destination in scope & 1,454,606 & 48,461 & 3.3\% &  \\
 Both in scope & 479,882 & 24,843 & 5.2\% & \\
 All journeys & 5,852,298 & 140,180 & 2.4\% \\ 
\end{tabular}
\caption{Journeys to work by location and type}
\label{table:commute_data}
\end{table}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Defining Networks}

There are three possible ways to construct a set of ways and nodes from OSM. These are; a positive filter; a negative filter; and selecting by relation. A positive filter specifies tags that a way or node must have to be included. A negative filter includes all ways and nodes without the tags specified. A relation is the OSM term for a collection of ways and nodes that belong to a set identified by an OSM contributor. 

The key challenge is described by \textcite{furth2016network} as; ``to measure miles of designated bike facilities can be misleading. Some designated bicycling facilities involve LTS values that most people will not tolerate.''

OSM relations in London identified as being cycle routes are mapped in Figure \ref{fig:bicycle_relation}. The query for selecting this set can be found in the Appendix table \ref{table:osm_tags}. It is clear that this is an extensive network, but the density of is fairly low and for almost any trip a user would need to venture beyond the relation geometries. Further, many of the ways included in the cycling relations are in fact no different from other streets. As seen in Figure \ref{fig:brandon} a picture of Brandon Way. This has no safety improvements for cyclists, and it has been observed that speeds can far exceed the 20 mph limit. Thus, the cycle relations on their own are insufficient for building representative networks. 

A good example of the difficulty of building a good network representation is Castle Baynard Street. It connects the Central London part of Cycle Super Highway 3 with the East London section that continues out to Limehouse. This is a tunnel that serves as a bike path and as a driveway to an underground car park. A network built from the relation[route=bicycle] set of ways and nodes would include this but the street has no dedicated cycle infrastructure and is therefore tagged as ``highway = unclassified.'' 




Compare Relation = cycleway to a list of edges and nodes tagged cycleway

Adding living streets and residential streets don't do much. 

Part of the problem is the lack of consistent tagging, it only takes one line segment missing a tag to disconnect two nodes,

but this also reflects the fact that getting somewhere within London nearly always requires leaving cycle infrastructure at some point and using main roads.

In the case of the relation, the Camden Hackney Quietway was examined in person. Figure \ref{fig:brandon} shows an image of Brandon Road, a part of the Quietway. This way is tagged ``highway=unclassified'' and connects to Agar Grove, tagged ``highway = tertiary''. The unclassified marker indicates that the street is less important than a tertiary street but is neither residential or a service road. As can been seen in the image, Brandon Rd. has no actual cycle infrastructure. There is a tag noting the max speed is 20 mph. Data collected for 20 mph streets found that as many as 80\% of drivers exceeded these limits. CITE?
% https://www.thesun.co.uk/news/7253694/20-mph-zones-cause-more-deaths/

In other cases, OSM underestimates the quality of cycling infrastructure. For instance the intersection of Mile End Road and Cambridge Heath Road in the borough of Tower Hamlets is a high traffic intersection both for automobiles and for cyclists. It is an integral part of the Stratford to Aldgate cycle super highway. This intersection has been reworked to be safer for cyclists. In OpenStreetMap though, it is labeled \texttt{highway=trunk}, due to its high traffic nature. It is way \texttt{7058092014}. There is also a tag \texttt{cycleway:left=lane} indicating that there is a cycle lane on the left side of the street. (\cite{osm})


\begin{figure}
\centering
\includegraphics[width=0.6\textwidth]{brandon_rd_cropped}
\caption{Camden Hackney Quietway}
\label{fig:brandon}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.6\textwidth]{euston_rd_cropped}
\caption{Euston Road}
\label{fig:euston}
\end{figure}

\begin{figure}
  \centering
%  \includegraphics[width=0.5\linewidth]{}
  \caption{Castle Baynard St}
  \label{fig:baynard}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{relations}
\caption{Relations identified as bicycle related.}
\label{fig:bicycle_relation}
\end{figure}

A positive filter was explored to include exactly the edges and nodes that met a given level of stress for cycling. This method was challenged by the fact that a single road segment not tagged accurately would disconnect a network part. Further, there was not a method found to work correctly for selecting roads with any one of many tag values.  Table \ref{table:osm_tags} details all the possible tags related to cycling that were found in the London OSM data.  In the Overpass Turbo application, this could be accomplished by using multiple subqueries as detailed in the Overpass Turbo Cycling network query listed in the Appendix. In OSMnx this multiple query statement structure was not an option. Thus a method for building full and accurate networks of OSM geometries using a positive filter was not found. 

\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{highway_cycleway}
\caption{Highways identified as cycleways.}
\label{fig:highway_cycleway}
\end{figure}


\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{primary_trunk}
\caption{Highways tagged primary or trunk}
\label{fig:primary_trunk}
\end{figure}

The negative filter, implemented as a modification of the filters built into \texttt{OSMnx version 0.11dev}, was the most successful. The first filter included all ways and nodes not explicitly tagged with values indicating that cycling was not allowed. Row 9 of Appendix \ref{table:filters} contains the Overpass API filter used for this. The second filter was the same as the first but excluded streets tagged as \texttt{primary} and \texttt{trunk}, row 2 of the Table \ref{table:filters}. These are the two tags used for the highest priority street types as seen in Table \ref{table:osm_tags} describing standard tags for the \texttt{highway} key in OSM. These streets are visualized in Figure ~\ref{fig:primary_trunk} The third filter restricted secondary streets in addition to the restrictions of the second. The fourth filter restricted tertiary streets leaving only living and residential streets in addition to non-motor vehicle ways like canal paths and segregated cycle lanes. The final filter, 5, restricted all edges where a cyclist might interact with motor vehicles. Samples of these filters are displayed in Figures ~\ref{fig:sub1} through ~\ref{fig:sub4}

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{bbox_bike_1_filter_cropped}
  \captionof{figure}{D1: most confident cyclists}
  \label{fig:sub1}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{bbox_bike_5_filter_cropped}
  \captionof{figure}{D5: no interaction with cars}
  \label{fig:sub2}
\end{minipage}
\end{figure}


Lastly, two more networks were specified. These were networks 1 and 2, all streets and all streets but primary and trunk, with the directionality of the streets removed. These networks would be used to test the effect of direction restrictions on travel times and whether removing direction restrictions for cyclists could successfully replace the need to use some more busy and dangerous streets. 

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{bbox_bike_2_filter_cropped}
  \captionof{figure}{no primary or trunk streets}
  \label{fig:sub3}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{bbox_bike_4_filter_cropped}
  \captionof{figure}{residential \& living streets}
  \label{fig:sub4}
\end{minipage}
\end{figure}



The weakness of the negative filter was the inability to include streets tagged as multiple types. Negative filter 2 excluded any highway tagged primary regardless of whether it was also tagged with \texttt{cycleway} or \texttt{cycleway:left=lane}. Thus the negative filters also do not fully reflect the reality of the London street network for a cyclist. However, it was the best method for testing the importance of street types and the effect of directionality on travel times. 


\subsubsection{Quant Network}

The QUANT dataset has 23,377,225 pairs of origins and destinations. The subset matching the scope of this investigation has 799,236 pairs. That subset has 200,041 pairs missing distances where there was no connection between the origin and destination transit hubs.

To complete the missing distances, the QUANT travel times were built into a \texttt{Networkx Multidigraph}. There was an edge for each node pair that represented the walking time between the nodes, calculated as the straight-line distance between the nodes divided by the google walking speed 3 mph converted to 4.83 kph and converted to 0.0805 kilometers per minute giving a number of minutes walking time between the nodes that was in the same units as the number of minutes public transit time between the nodes. 

Then for each pair of nodes missing a transit time, the shortest path on the graph was calculated. Each travel time can therefore be a combination of walking and riding public transit between nodes. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Origins and Destinations}

One origin/destination node was selected for each LSOA. The node was selected as the node from the set of nodes across all network definitions that was closest to the centroid of the LSOA polygon. This is essentially a sampling technique. While individual nodes may give strange results due to the specifics of their locations, it is expected that the average results for 894 nodes that yield 798,342 O/D pairs will be a sufficiently large sample that individual idiosyncrasies balance out. 

As seen in Figure~\ref{fig:dist_diffs} the distribution of the differences between the distance between centroids and the distance between actual nodes is well balanced. 

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{node_centroid_dist_diff}
  \captionof{figure}{Node v. Centroid distances}
  \label{fig:dist_diffs}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{quant_node_dist_diff}
  \captionof{figure}{Node v. QUANT distances}
  \label{fig:quant_dist_diffs}
\end{minipage}
\end{figure}

Node \texttt{5816785884}, closest to the centroid of LSOA \texttt{E01004225}, is found at the entrance to a garage at the end of a one way street, making every other node in the network inaccessible on the directed versions of the networks. The edge leading to this node is tagged \texttt{service} so perhaps service streets should have been excluded as they are frequently dead ends. 

Because urban density increases as one approached the center of a city, there could be a slight bias towards node distances being lower than centroid distances. This is because there is a higher probability that the closest node will be on the central side of the centroid than the outside. This was investigated and as seen in Figure \ref{fig:dist_diffs}, the distribution of differences in straight-line distances was well balanced around 0. The same consideration was checked for the differences between distances for cycling nodes and the distances between the nodes used in the QUANT calculations. Seen in Figure \ref{fig:quant_dist_diffs}, that distribution was also well balanced around 0. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Travel Times}

Travel times were converted from distances using a walking speed of 3 mph and a cycling speed of 8 mph based on data taken from Google maps estimates for journeys in London. These were converted to kilometers per minutes, waking: $0.0805$ and biking: $0.215$. 

As seen in Table \ref{table:travel_time_stats} contains statistics about the distances and travel times calculated. To make a direct comparison, the table shows travel times for only O/D pairs that were connected for each of the 4 networks that routes were calculated for.  

\begin{table}[]
%\centering
\begin{tabular}{lrrrrrrrrr}
\toprule
network                  & u\_1    & d\_1    & u\_2  & d\_2  & quant & quant+ & d\_3 & d\_4 & d\_5 \\ \midrule
%largest component edges  &         &         &       &       &  -    & -      &      &      &      \\
\% pairs connected       & 100     & 100     &  63.1 & 58.2  & 74.9  & 100    & 21.9 & 1.4  & 0.03 \\
average directness *     & 1.20    & 1.23    & 1.53  & 1.80  & -     & -      & -    & -    & -    \\
min travel time*         & 0.4     & 0.4     & 0.4   & 0.4   & 0.1   & -      & -    & -    & -    \\
mean travel time*        & 33.0    & 33.8    & 41.1  & 47.4  & 22.6  & -      & -    & -    & -    \\
max travel time*         & 88.8    & 91.2    & 114.0 & 124.0 & 51.9  & -      & -    & -    & -    \\
travel time std. dev*    & 16.8    & 17.1    & 20.4  & 23.6  & 8.6   & -      & -    & -    & -   \\ \bottomrule
\end{tabular}
\caption{Network routing statistics \\ $*$ includes only pairs connected by all four networks.}
\label{table:travel_time_stats}
\end{table}

\subsubsection{Street Types}

Removing primary and trunk highways raises travel times by about 33\%. nearly 40\% of origin destination pairs are disconnected in this scenario. 

The network doesn't really fracture. Where connectivity goes down, it is usually an individual node becoming disconnected from all others, not a sub group being separated of. Most nodes not connected to another node, were not connected to any other nodes. 

\subsubsection{Directedness}

The difference between directed and undirected distances is relatively small. This indicates that building multidirectional cycle infrastructure on side streets is probably not a good way to improve cyclist access.  


\subsubsection{Public Transit}

QUANT public transit times are substantially faster than cycling times. There was no origin destination pair where cycling was found to be faster than public transport. 

However, transit times are from hub to hub, so there is in most cases, an additional walking time to get from the transit hub to the actual destination that would be less of a factor for a journey by bicycle. 

\begin{table}
\centering
\begin{tabular}{@{}lllll@{}}
\toprule
networks & u\_1   & d\_1  & u\_2            & d\_2          \\ \midrule
         &        &       & \multicolumn{2}{l}{$\Delta$ time (mins)}  \\
u\_1     &       &  0.79 & 8.16            & 14.46         \\
d\_1     & 0      &      & 7.38            & 13.68         \\
u\_2     & 36.9   & 36.9  &                & 6.30          \\
d\_2     & 47.8   & 47.8  & 4.7             &              \\
         & \multicolumn{3}{l}{$\Delta$ \% connected} &               \\ \bottomrule
\end{tabular}
\caption{Changes between networks, \% connected and directness}
\label{table:change between nets}
\end{table}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Distributions of Travel Times}

Not only are the two modes of travel different in their means, the shape of the distribution is pretty different too. This is seen in Figures \ref{fig:d1_distrib} through \ref{fig:quant_distrib}. 

Some interesting observation about this. XXXXXXXXXX

% need consistent axes

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{d_1_travel_times_dist}
  \captionof{figure}{D1 Travel Time Distribution}
  \label{fig:d1_distrib}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{d_2_travel_times}
  \captionof{figure}{D2 Travel Time Distribution}
  \label{fig:d2_distrib}
\end{minipage}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{quant_travel_times_dist}
\caption{Distribution of QUANT public transit travel times}
\label{fig:quant_distrib}
\end{figure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Changes in Routing} 

There are three types of changes in routing that increase the distance a cyclist would have to travel that are exhibited in the data. 

The first is a large detour added to an otherwise fairly direct path. Figure \ref{fig:routing_1} shows the shortest route between Finsbury Park and the north side of Hyde Park. Removing the Primary and Trunk highways to produce the shortest route in Figure \ref{fig:routing_2}, a substantial detour through North Kensington is added, nearly doubling the total distance traveled. This is a trip that \cite{furth2016network} assumes would not take place, either the cyclist would use a higher stress route or the trip would not be accomplished by bicycle. The limit they set was a 25\% increase in the trip distance to avoid a high stress road. 

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d1_ex4}
  \captionof{figure}{Example 1, Network 1}
  \label{fig:routing_1}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d2_ex4}
  \captionof{figure}{Example 1, Network 2}
  \label{fig:routing_2}
\end{minipage}
\end{figure}

The second is the addition of a large number of small turns and detours throughout the trip. Consider the different between the routing on directed network 1 in Figure \ref{fig:routing_1} compared to the routing of the shortest path between the same origin and destination on direct network 2 in Figure \ref{fig:routing_2}, where primary and trunk streets are excluded. The network 2 route never strays very far from the network 1 route but the distance increases by 10\%. Comparing by distance is informative but it is useful to keep in mind that traveling through intersections probably lowers the overall speed of a trip so that actual travel time and power expended probably increase by more than distance increases. 

% death by 1000 cuts routing.
\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d1_ex9}
  \captionof{figure}{Example 2, Network 1}
  \label{fig:routing_3}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d2_ex9}
  \captionof{figure}{Example 2, Network 2}
  \label{fig:routing_4}
\end{minipage}
\end{figure}

\begin{figure}
\centering
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d1_ex7}
  \captionof{figure}{Example 3, Network 1}
  \label{fig:routing_5}
\end{minipage}%
\begin{minipage}{.5\textwidth}
  \centering
  \includegraphics[width=0.98\linewidth]{cropped_route_diff_d2_ex7}
  \captionof{figure}{Example 3, Network 2}
  \label{fig:routing_6}
\end{minipage}
\end{figure}

A third illustrative example has to do with the compounding of detours. Figure \ref{fig:routing_5} shows the shortest route between Dalston and North Kensington. Avoiding primary and trunk streets in Figure \ref{fig:routing_6} increases distance by 30\%. This is because, while much of the route is along the Regents Canal Path, a stretch of Euston Road between the end of the path in Angel and Regents part is a \texttt{trunk} highway. Avoiding this stretch renders the canal path useless. Thus in true network fashion, isolated changes can have large effects on the importance of other segments of the network. 

Finally, in exploring individual changes in routing, it was noticed generally that trips through the northern most and western most sections of the area investigated tended to be the trips with dramatic increases in distance. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsubsection{Maps}

To explore whether this trend in northern and western London was real maps were built showing the average values for each LSOA. In each map, areas within the boundary that are not colored are LSOA's that are not connected to any other LSOA. For Directed network 2, this is about 100 of 900 areas.  

It can be seen in Figure \ref{fig:d1_d2_directness} that directness decreases substantially in the northern and western parts of the area as seen by the darker red areas there. This is consistent with the anecdotal observation that many of the larger changes in routing distance involved passing through or around these areas. 

A different pattern is seen in comparing cycling time with public transport time Figure \ref{fig:quant_d1_time}. Here Canary Wharf is relatively difficult to access by bicycle. This may be influenced by the fact that it is on the periphery of the area of investigation. It could also be influenced by public transit that travels across the river and through South London. This routing option was not available to the cycling routes as it was outside the scope of the network defined. It is thought that the quickest option for cycling to Canary Wharf would involve Mile End Road or Cycle Super Highway Three, and not crossing to the south side of the river due to the difficulty of crossing back over around the eastern end of the river. 



\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{d_1_d_2_directness}
\caption{Difference in directness D1 and D2}
\label{fig:d1_d2_directness}
\end{figure}

\begin{figure}
\centering
\includegraphics[width=0.85\linewidth]{quant_plus_d1_time_diff_perc}
\caption{\% Difference in travel time, QUANT+ and D1}
\label{fig:quant_d1_time}
\end{figure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Notes About Computation}

Several related works mention computational limitations to their analysis as a factor determining the scope. These sources did not provide data about their computations, which could have informed this analysis. That data is included here in the hope of assisting future research planning and the search for possible improvements in efficiency. 

Runtimes for the distances between nodes were long. Computations were done on an Intel i74700HQ processor with the database contained on the internal Solid State Drive. 

Runtimes increased with the number of connected origin destination pairs, since unconnected pairs  did not require the calculation of a shortest path. Thus bike 1 travel times took longer than bike level 2. Additionally, the undirected network calculations took substantially longer than the directed networks because there were significantly more route possibilities with more edges available at each node. 

Distances between 1000 pairs were calculated as a test using three search algorithms from \texttt{Networkx}. The results are found in Table \ref{table:comp_times_algos} XXXX. 

Table \ref{table:net_calc_times} contains calculation times by network type. 

\begin{table}[]
\centering
\begin{tabular}{@{}lcccc@{}}
%\toprule
network     & 1 directed  & 1 undirected & 2 directed  & 2 undirected \\ 
\midrule
time(hours) & 24 & 72  & 9 & 36 \\ \bottomrule
\end{tabular}
\caption{Calculation times for routes}
\label{table:net_calc_times}
\end{table}

%\begin{table}
%\centering
%\caption{Computation times using different algorithms}
%\label{table:comp_times_algo}
%\end{table}
